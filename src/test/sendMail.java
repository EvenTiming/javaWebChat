package test;

import com.sun.mail.util.MailSSLSocketFactory;

import java.util.*;
import javax.mail.*;
import javax.mail.internet.*;

public class sendMail {
	private  String UserMailbox;
	private  String VerificationCode;
	String MailText1="您的聊天室验证码为";
	String MailText2="该验证码15分钟内有效，如果非本人操作请忽略本邮件";		
	public sendMail(String UserMailbox,String VerificationCode) {
		this.UserMailbox=UserMailbox;
		this.VerificationCode=VerificationCode;
	}
    public void send() throws Exception {

        Properties prop = new Properties();
        prop.setProperty("mail.host", "smtp.qq.com");//  ????QQ?????????
        prop.setProperty("mail.transport.protocol", "smtp"); // ???????Э??
        prop.setProperty("mail.smtp.auth", "true"); // ???????????????

        // ????QQ???????????SSL??????????????????
        MailSSLSocketFactory sf = new MailSSLSocketFactory();
        sf.setTrustAllHosts(true);
        prop.put("mail.smtp.ssl.enable", "true");
        prop.put("mail.smtp.ssl.socketFactory", sf);

        //???JavaMail?????????5??????

        //??????????????ó???????????????? Session ????

        Session session = Session.getDefaultInstance(prop, new Authenticator() {
            public PasswordAuthentication getPasswordAuthentication() {
                //?????????????????????
                return new PasswordAuthentication("*******", "********");
            }
        });


        //????Session??debug??????????????????????Email????????
       // session.setDebug(true);

        //2?????session???transport????
        Transport ts = session.getTransport();

        //3???????????????????????????????????
        ts.connect("smtp.qq.com", "*******", "********");

        //4?????????

        //???????????
        MimeMessage message = new MimeMessage(session);

        //?????????????
        message.setFrom(new InternetAddress(""*******",@qq.com"));

        //????????????????????????????????????????????????????
        message.setRecipient(Message.RecipientType.TO, new InternetAddress(UserMailbox));

        //????????
        message.setSubject("验证邮件");

        //????????????
        message.setContent(MailText1+VerificationCode+"\n"+MailText2, "text/html;charset=UTF-8");

        //5?????????
        ts.sendMessage(message, message.getAllRecipients());

        ts.close();
    }

}
